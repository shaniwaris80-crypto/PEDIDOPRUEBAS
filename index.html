<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ARSLAN LISTAS v3.4 â€” KIWI MOBILE TABS</title>

  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css" />

  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <!-- âœ… Para generar LINK Repartidor comprimido -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.5.0/lz-string.min.js"></script>
</head>

<body>
  <div class="topbar">
    <div class="left">
      <h1>ğŸˆ ARSLAN LISTAS v3.4 â€” KIWI MOBILE TABS</h1>
      <span class="pill">Modo mÃ³vil optimizado</span>
      <span class="pill">ğŸšš Reparto link: /reparto/</span>

      <span class="price-chip" title="Atajos de cantidades">
        <span class="kbd">+</span><span class="kbd">-</span>
        <span class="kbd">â†‘</span><span class="kbd">â†“</span>
        <span class="kbd">Shift</span>=10
        <span class="kbd">Alt</span>=0,1
      </span>
    </div>

    <div class="toolbar">
      <button class="btn ghost small" id="btnLinkRepartidor">ğŸšš Link Repartidor</button>
      <button class="theme-toggle" id="btnTheme" title="Cambiar tema">ğŸŒ— Tema</button>
    </div>
  </div>

  <div class="container">
    <div class="hint" style="margin-bottom:10px">
      Flujo: Diccionario â†’ Tiendas/Clientes (Estandarizar) â†’ Global (Unificar/Asignar) â†’ Proveedores (TXT) â†’ Reparto â†’ Precios (WhatsApp/TXT/PDF)
    </div>

    <!-- TAB: Diccionario -->
    <section class="tab" id="tab-dic">
      <!-- âœ… Resumen del dÃ­a -->
      <div class="card">
        <div class="hd">
          <strong>ğŸ“Š Resumen del dÃ­a</strong>
          <div class="toolbar">
            <button class="btn ghost" id="btnRefreshResumen">ğŸ”„ Refrescar</button>
            <button class="btn muted" id="btnGoGlobal">ğŸ§® Ir a Global</button>
            <button class="btn muted" id="btnGoProveedores">ğŸ“¦ Ir a Proveedores</button>
          </div>
        </div>
        <div class="bd">
          <div class="grid-3" id="resumen_cards"></div>
          <div class="hint" style="margin-top:8px">
            Tip: Asigna desde Global con âœ… al proveedor activo. En Proveedores mete precios (se guardan en Lista de precios).
          </div>
        </div>
      </div>

      <div class="card">
        <div class="hd">
          <strong>ğŸ“š Vocabulario estandarizado (editable)</strong>
          <div class="toolbar">
            <button class="btn ghost" id="btnNewWord">+ Nuevo producto</button>
            <button class="btn ghost" id="btnSaveVocab">Guardar vocabulario</button>
            <button class="btn muted" id="btnLimpiarDia">ğŸ§¹ Limpiar dÃ­a</button>
            <button class="btn muted" id="btnResetAll">ğŸ’¥ Reset total</button>
          </div>
        </div>
        <div class="bd">
          <div class="hint" style="margin-bottom:6px">
            Un producto por lÃ­nea. Se normaliza a <b>MAYÃšSCULAS</b> sin tildes. Sin duplicados.
          </div>
          <textarea id="vocabTxt"></textarea>
        </div>
      </div>
    </section>

    <!-- TAB: Tiendas -->
    <section class="tab" id="tab-tiendas" style="display:none">
      <div class="grid-3">
        <!-- San Pablo -->
        <div class="card">
          <div class="hd">
            <strong>ğŸª San Pablo</strong>
            <div class="toolbar">
              <button class="btn ghost" data-action="estandarizar" data-code="sp">Estandarizar</button>
              <button class="btn" data-action="guardarTienda" data-code="sp">Guardar</button>
              <button class="btn muted" data-action="exportarTiendaTXT" data-code="sp">ğŸ“„ TXT</button>
              <button class="btn muted" data-action="enviarTiendaWhatsApp" data-code="sp">ğŸ“² WhatsApp</button>
            </div>
          </div>
          <div class="bd">
            <textarea id="in_sp" placeholder="Pega lista San Pablo..."></textarea>
            <div class="hint">Edita en tabla: OK = verde, Revisar = rojo. Sugerencias al escribir. Cantidades con teclado (+/-/â†‘/â†“).</div>
            <div id="tbl_sp_wrap" class="scroll-x" style="margin-top:8px"></div>
          </div>
        </div>

        <!-- San Lesmes -->
        <div class="card">
          <div class="hd">
            <strong>ğŸª San Lesmes</strong>
            <div class="toolbar">
              <button class="btn ghost" data-action="estandarizar" data-code="sl">Estandarizar</button>
              <button class="btn" data-action="guardarTienda" data-code="sl">Guardar</button>
              <button class="btn muted" data-action="exportarTiendaTXT" data-code="sl">ğŸ“„ TXT</button>
              <button class="btn muted" data-action="enviarTiendaWhatsApp" data-code="sl">ğŸ“² WhatsApp</button>
            </div>
          </div>
          <div class="bd">
            <textarea id="in_sl" placeholder="Pega lista San Lesmes..."></textarea>
            <div class="hint">Edita en tabla: OK = verde, Revisar = rojo. Sugerencias al escribir. Cantidades con teclado (+/-/â†‘/â†“).</div>
            <div id="tbl_sl_wrap" class="scroll-x" style="margin-top:8px"></div>
          </div>
        </div>

        <!-- Santiago -->
        <div class="card">
          <div class="hd">
            <strong>ğŸª Santiago</strong>
            <div class="toolbar">
              <button class="btn ghost" data-action="estandarizar" data-code="st">Estandarizar</button>
              <button class="btn" data-action="guardarTienda" data-code="st">Guardar</button>
              <button class="btn muted" data-action="exportarTiendaTXT" data-code="st">ğŸ“„ TXT</button>
              <button class="btn muted" data-action="enviarTiendaWhatsApp" data-code="st">ğŸ“² WhatsApp</button>
            </div>
          </div>
          <div class="bd">
            <textarea id="in_st" placeholder="Pega lista Santiago..."></textarea>
            <div class="hint">Edita en tabla: OK = verde, Revisar = rojo. Sugerencias al escribir. Cantidades con teclado (+/-/â†‘/â†“).</div>
            <div id="tbl_st_wrap" class="scroll-x" style="margin-top:8px"></div>
          </div>
        </div>
      </div>

      <!-- âœ… CLIENTES/HOTELES -->
      <div class="card" style="margin-top:12px">
        <div class="hd">
          <strong>ğŸ¨ Clientes / Hoteles (con TAG)</strong>
          <div class="toolbar">
            <button class="btn ghost" id="btnAddClient">+ Nuevo cliente</button>
            <button class="btn muted" id="btnSaveClients">Guardar clientes</button>
          </div>
        </div>
        <div class="bd">
          <div class="hint" style="margin-bottom:8px">
            AÃ±ade pedidos de hoteles/clientes (Braseros Centro/Forum/Edificio/Tomillares/Severo, Riviera, etc.).  
            âœ… Solo cuentan si tienen lÃ­neas. Se suman a Global/Proveedores/Reparto.
          </div>
          <div id="clients_wrap"></div>
        </div>
      </div>
    </section>

    <!-- TAB: Global -->
    <section class="tab" id="tab-global" style="display:none">
      <div class="card">
        <div class="hd">
          <strong>ğŸ§® UnificaciÃ³n global</strong>
          <div class="toolbar">
            <button class="btn ghost" id="btnUnificar">Unificar todo</button>
            <button class="btn muted" id="btnExportGlobalTXT">TXT visible</button>
            <button class="btn muted" id="btnExportGlobalXLSX">Excel</button>
            <button class="btn" id="btnResumenGlobalTXT">ğŸ“„ TXT Global</button>
            <button class="btn muted" id="btnCopiarGlobal">Copiar</button>
          </div>
        </div>
        <div class="bd">
          <div class="hint">
            âœ… a la izquierda asigna al proveedor activo. Duplicados probables se marcan en rojo (<b>âš ï¸</b>).
            Cantidades con teclado (+/-/â†‘/â†“). Enter baja a la siguiente celda.
          </div>

          <div class="card" style="margin-top:8px">
            <div class="bd">
              <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
                <span class="hint">Proveedor activo:</span>
                <div class="prov-bar" id="provBar"></div>
              </div>
            </div>
          </div>

          <div class="toolbar" style="margin-top:8px">
            <button class="btn ghost small" id="btnUndo">â†©ï¸ Deshacer</button>
            <span class="pill" id="undoPill">Undo: 0</span>
          </div>

          <div id="global_wrap" class="scroll-x" style="margin-top:8px"></div>
        </div>
      </div>
    </section>

    <!-- TAB: Proveedores -->
    <section class="tab" id="tab-proveedores" style="display:none">
      <div class="card">
        <div class="hd"><strong>ğŸ“¦ DistribuciÃ³n por proveedor</strong></div>
        <div class="bd">
          <div class="grid-3" id="provPanels" style="margin-top:8px"></div>
        </div>
      </div>

      <!-- âœ… PRECIOS (solo comprado/actualizado desde proveedores) -->
      <div class="card" style="margin-top:12px">
        <div class="hd">
          <strong>ğŸ’¶ Lista de precios (solo productos con precio)</strong>
          <div class="toolbar">
            <button class="btn small muted" id="btnRefreshPrices">ğŸ”„ Refrescar</button>
            <button class="btn small" id="btnPricesWA">ğŸ“² WhatsApp</button>
            <button class="btn small muted" id="btnPricesTXT">ğŸ“„ TXT</button>
            <button class="btn small muted" id="btnPricesPDF">ğŸ§¾ PDF (cuadrÃ­cula)</button>
            <button class="btn small muted" id="btnResetPrices">ğŸ§½ Reset precios</button>
          </div>
        </div>
        <div class="bd">
          <div class="hint" style="margin-bottom:8px">
            âœ… Los precios se meten en Proveedores (por lÃ­nea) y se guardan aquÃ­.  
            AquÃ­ solo se muestran productos que tienen precio. Exporta WhatsApp/TXT/PDF desde aquÃ­.
          </div>
          <div id="prices_wrap" class="scroll-x"></div>
        </div>
      </div>

      <!-- REPARTO -->
      <div class="card" style="margin-top:12px">
        <div class="hd">
          <strong>ğŸšš Reparto (tiendas + clientes)</strong>
          <div class="toolbar">
            <button class="btn small" id="btnRepartoWA">ğŸ“² WhatsApp</button>
            <button class="btn small muted" id="btnRepartoTXT">ğŸ“„ TXT</button>
            <button class="btn small muted" id="btnRepartoPDF">ğŸ§¾ PDF (cuadrÃ­cula)</button>
          </div>
        </div>
        <div class="bd">
          <div class="hint" style="margin-bottom:8px">
            Selecciona destino. Marca lo repartido y exporta.  
            Si el producto tiene precio en â€œLista de preciosâ€, se autocompleta.
          </div>

          <div style="margin-bottom:8px;">
            <select id="selRepartoTienda"></select>
          </div>
          <div id="reparto_wrap" class="scroll-x"></div>
        </div>
      </div>
    </section>
  </div>

  <!-- FAB Global -->
  <button class="fab" id="fab" title="Acciones rÃ¡pidas" style="display:none">âš™ï¸</button>
  <div class="fab-menu" id="fabMenu">
    <button class="fab-item" id="fabUnificar">ğŸ”„ Unificar</button>
    <button class="fab-item" id="fabTxt">ğŸ“„ TXT visible</button>
    <button class="fab-item" id="fabXlsx">ğŸ“Š Excel</button>
    <button class="fab-item" id="fabCopiar">ğŸ“‹ Copiar</button>
    <button class="fab-item" id="fabResumen">ğŸ§¾ TXT Global</button>
  </div>

  <!-- Tabbar -->
  <nav class="tabbar">
    <button id="btn-dic" class="active" data-tab="dic">ğŸ“š<span>Diccionario</span></button>
    <button id="btn-tiendas" data-tab="tiendas">ğŸª<span>Tiendas</span></button>
    <button id="btn-global" data-tab="global">ğŸ§®<span>Global</span></button>
    <button id="btn-proveedores" data-tab="proveedores">ğŸ“¦<span>Proveedores</span></button>
  </nav>

  <script src="app.js"></script>
</body>
</html>
